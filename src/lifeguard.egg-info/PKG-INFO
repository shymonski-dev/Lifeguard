Metadata-Version: 2.4
Name: lifeguard
Version: 0.1.0
Summary: Security-focused agent design and verification
Author: Lifeguard Contributors
License: MIT
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Provides-Extra: dev
Requires-Dist: pytest>=8.0; extra == "dev"
Provides-Extra: graph-runtime
Requires-Dist: langchain>=1.0.0; extra == "graph-runtime"
Requires-Dist: langgraph>=1.0.0; extra == "graph-runtime"

# Lifeguard

Lifeguard is a standalone project for designing and verifying secure, tool-using agents.

## What this project does

1. Loads an agent specification from JSON.
2. Compiles a concrete policy from that specification.
3. Applies threat checks based on risk level.
4. Runs a verification pipeline before release, including optional live intelligence freshness checks.
5. Writes append-only evidence records with a hash chain.
6. Supports optional deterministic Lang Graph runtime execution.

## Project layout

- `src/lifeguard/spec_schema.py`: Specification model and validation.
- `src/lifeguard/policy_compiler.py`: Policy generation and command checks.
- `src/lifeguard/threat_model.py`: Risk templates and policy checks.
- `src/lifeguard/verification_pipeline.py`: Ordered verification steps.
- `src/lifeguard/evidence_store.py`: Tamper-evident evidence log.
- `src/lifeguard/live_intelligence.py`: Provider-backed live web intelligence with citations.
- `src/lifeguard/langgraph_runtime.py`: Deterministic Lang Graph adapter runtime.
- `src/lifeguard/open_source_guardrails.py`: Open source mode startup guardrails.
- `src/lifeguard/release_workflow.py`: Adapter-backed release packaging with signature.
- `src/lifeguard/cli.py`: Command line entry point.
- `src/lifeguard/adapters/dgm_non_evolution.py`: Adapter layer for selected non-evolution modules.

## Quick start

```bash
cd /Volumes/SSD2/Projects/dgm-optimal/lifeguard
export OPENROUTER_API_KEY="your-key"
pip install -e ".[graph_runtime]"
PYTHONPATH=src python3 -m lifeguard init --path spec.json
PYTHONPATH=src python3 -m lifeguard verify --spec spec.json --evidence evidence/events.jsonl --repo /path/to/repo
PYTHONPATH=src python3 -m lifeguard verify --spec spec.json --evidence evidence/events.jsonl --runtime langgraph
PYTHONPATH=src python3 -m lifeguard intelligence --spec spec.json
PYTHONPATH=src python3 -m lifeguard release --spec spec.json --evidence evidence/events.jsonl --output release_artifacts --approved-by security-reviewer --approval-id approval-001 --signing-key-file ./keys/release_signing.key
```

Default starter profile:

1. Agent type: secure code review
2. Risk strictness: high
3. Runtime environment: container
4. Live intelligence: enabled, provider `openrouter`, model `openai/gpt-5.2:online`

## Notes

- This project is intentionally separate from the Darwin-Godel code.
- Lifeguard uses a deterministic design method and blocks evolutionary process commands.
- You can later add adapters that call only non-evolutionary `dgm` modules without changing this baseline.

## Adapter layer

Selected modules currently wrapped by the adapter layer:

1. `dgm.core.circuit_breaker`
2. `dgm.core.retry`
3. `dgm.core.json_parser`
4. `dgm.core.security_preflight`
5. `dgm.core.analyzer_usage`
6. `dgm.core.model_registry`
7. `dgm.core.ast_guard`

Verification and release use this adapter layer directly.

## Live intelligence

Lifeguard can enforce fresh, cited design intelligence during verification.

1. `live_data.enabled=true` turns the check on.
2. `live_data.provider` can be `openrouter`, `openai`, or `anthropic`.
3. `live_data.min_citations` enforces minimum source count.
4. `live_data.allowed_domains` can restrict source domains.
5. `live_data.strict=true` blocks verification when freshness fails.

Environment variables by provider:

1. Open Router: `OPENROUTER_API_KEY`
2. Open Artificial Intelligence: `OPENAI_API_KEY`
3. Anthropic: `ANTHROPIC_API_KEY`

## Open source guardrails

Lifeguard blocks Lang Smith service configuration in open source mode.

Blocked environment variables:

1. `LANGSMITH_API_KEY`
2. `LANGCHAIN_API_KEY`
3. `LANGSMITH_ENDPOINT`
4. `LANGCHAIN_ENDPOINT`
5. `LANGCHAIN_TRACING_V2` when enabled
6. `LANGSMITH_TRACING` when enabled

You can run a local package license check with:

```bash
python scripts/check_open_source_licenses.py --allow-missing
```

## Lang Graph runtime

`verify` supports two runtime modes:

1. `standard`: Current verification pipeline.
2. `langgraph`: Deterministic fixed-step graph:
   - load specification
   - collect live intelligence
   - compile policy
   - run threat checks
   - run verification pipeline

## Release controls

1. High-risk release publishing requires `--approved-by` and `--approval-id`.
2. Release manifest signing uses key-based `hmac-sha256`.
3. Signing key sources:
   - `--signing-key-file`
   - `LIFEGUARD_SIGNING_KEY_FILE`
   - `LIFEGUARD_SIGNING_KEY`

## Continuous integration

Automated verification and release checks are defined in:

1. `/Volumes/SSD2/Projects/dgm-optimal/.github/workflows/lifeguard.yml`
